import{e as pa,f as w,c as _a,a as S,g as fa}from"../chunks/CtCoybIn.js";import{i as ba}from"../chunks/BKqJgErF.js";import{aK as Oe,aL as ga,v as ma,aM as ya,aN as ka,aO as ha,M as O,aP as Pe,aQ as xa,u as g,ad as za,z as Sa,p as Je,c as s,r as t,G as n,H as Ge,d as e,t as L,a as Ve,y as K,o as Ca,J as re,K as wa,s as u,aR as Da,f as Ma,aS as Na}from"../chunks/DTfDAl4_.js";import{s as p}from"../chunks/zLC_yYsZ.js";import{i as W}from"../chunks/7tgxHHI9.js";import{e as he,i as Ta,A as Fe,c as Ka,a as La,u as Aa}from"../chunks/BDHSxgV7.js";import{r as xe,s as We,a as Ba,b as Ea}from"../chunks/CvDsuMjO.js";import{s as qa,a as Fa}from"../chunks/DKdwQT7R.js";import{s as Re,p as Ra}from"../chunks/CsqScXD4.js";import{p as Ia}from"../chunks/CcdyCa3o.js";function Qe(a,i,m=!1){if(a.multiple){if(i==null)return;if(!ya(i))return ka();for(var b of a.options)b.selected=i.includes(te(b));return}for(b of a.options){var _=te(b);if(ha(_,i)){b.selected=!0;return}}(!m||i!==void 0)&&(a.selectedIndex=-1)}function Oa(a){var i=new MutationObserver(()=>{Qe(a,a.__value)});i.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ma(()=>{i.disconnect()})}function Pa(a,i,m=i){var b=new WeakSet,_=!0;Oe(a,"change",r=>{var h=r?"[selected]":":checked",d;if(a.multiple)d=[].map.call(a.querySelectorAll(h),te);else{var f=a.querySelector(h)??a.querySelector("option:not([disabled])");d=f&&te(f)}m(d),O!==null&&b.add(O)}),ga(()=>{var r=i();if(a===document.activeElement){var h=Pe??O;if(b.has(h))return}if(Qe(a,r,_),_&&r===void 0){var d=a.querySelector(":checked");d!==null&&(r=te(d),m(r))}a.__value=r,_=!1}),Oa(a)}function te(a){return"__value"in a?a.__value:a.value}function Ie(a,i,m=i){var b=new WeakSet;Oe(a,"input",async _=>{var r=_?a.defaultValue:a.value;if(r=ye(a)?ke(r):r,m(r),O!==null&&b.add(O),await xa(),r!==(r=i())){var h=a.selectionStart,d=a.selectionEnd,f=a.value.length;if(a.value=r??"",d!==null){var c=a.value.length;h===d&&d===f&&c>f?(a.selectionStart=c,a.selectionEnd=c):(a.selectionStart=h,a.selectionEnd=Math.min(d,c))}}}),(Sa&&a.defaultValue!==a.value||g(i)==null&&a.value)&&(m(ye(a)?ke(a.value):a.value),O!==null&&b.add(O)),za(()=>{var _=i();if(a===document.activeElement){var r=Pe??O;if(b.has(r))return}ye(a)&&_===ke(a.value)||a.type==="date"&&!_&&!a.value||_!==a.value&&(a.value=_??"")})}function ye(a){var i=a.type;return i==="number"||i==="range"}function ke(a){return a===""?null:+a}var Ja=w('<span class="meta svelte-at7k0o"> </span>'),Ga=w('<span class="reason svelte-at7k0o"> </span>'),Va=w('<div><div class="main svelte-at7k0o"><div class="label svelte-at7k0o"><span> </span> <!> <!></div> <span class="points svelte-at7k0o"> </span></div> <div class="counter svelte-at7k0o"><button type="button" class="step svelte-at7k0o">-</button> <input type="number" min="0" inputmode="numeric" class="svelte-at7k0o"/> <button type="button" class="step svelte-at7k0o">+</button></div></div>'),Wa=w('<span class="reason svelte-at7k0o"> </span>'),Qa=w('<label><input type="checkbox"/> <span class="label svelte-at7k0o"> <!></span> <span class="points svelte-at7k0o"> </span></label>'),Ha=w('<section class="group svelte-at7k0o"><h2> </h2> <div class="items svelte-at7k0o"></div></section>');function Ya(a,i){Je(i,!0);let m=Ia(i,"counts",19,()=>({}));function b(c){const l=typeof c=="number"?c:Number(c);return Number.isFinite(l)?Math.max(0,Math.floor(l)):0}function _(c,l){i.onCountChange(c,b(l))}var r=Ha(),h=s(r),d=s(h,!0);t(h);var f=n(h,2);he(f,21,()=>i.activities,c=>c.key,(c,l)=>{var D=_a(),Q=Ge(D);{var P=C=>{var y=Va();let A;var k=s(y),M=s(k),R=s(M),H=s(R,!0);t(R);var J=n(R,2);{var G=x=>{var B=Ja(),j=s(B);t(B),L(()=>p(j,`${e(l).durationMinutes??""}m`)),S(x,B)};W(J,x=>{e(l).durationMinutes&&x(G)})}var X=n(J,2);{var E=x=>{var B=Ga(),j=s(B);t(B),L(()=>p(j,`(${i.disabledReasonByKey[e(l).key]??""})`)),S(x,B)};W(X,x=>{i.disabledReasonByKey?.[e(l).key]&&x(E)})}t(M);var q=n(M,2),Z=s(q);t(q),t(k);var $=n(k,2),V=s($);V.__click=()=>_(e(l).key,(m()?.[e(l).key]??0)-1);var I=n(V,2);xe(I),I.__input=x=>_(e(l).key,Number(x.currentTarget.value));var Y=n(I,2);Y.__click=()=>_(e(l).key,(m()?.[e(l).key]??0)+1),t($),t(y),L(()=>{A=Re(y,1,"item repeatable svelte-at7k0o",null,A,{disabled:i.disabledKeys?.[e(l).key]??!1}),p(H,e(l).label),p(Z,`${e(l).points??""}pt ea`),We($,"aria-label",`Count for ${e(l).label}`),V.disabled=i.disabledKeys?.[e(l).key]??!1,I.disabled=i.disabledKeys?.[e(l).key]??!1,Ba(I,m()?.[e(l).key]??0),Y.disabled=i.disabledKeys?.[e(l).key]??!1}),S(C,y)},F=C=>{var y=Qa();let A;var k=s(y);xe(k),k.__change=E=>i.onToggle(e(l).key,E.currentTarget.checked);var M=n(k,2),R=s(M),H=n(R);{var J=E=>{var q=Wa(),Z=s(q);t(q),L(()=>p(Z,`(${i.disabledReasonByKey[e(l).key]??""})`)),S(E,q)};W(H,E=>{i.disabledReasonByKey?.[e(l).key]&&E(J)})}t(M);var G=n(M,2),X=s(G);t(G),t(y),L(()=>{A=Re(y,1,"item svelte-at7k0o",null,A,{disabled:i.disabledKeys?.[e(l).key]??!1}),k.disabled=i.disabledKeys?.[e(l).key]??!1,Ea(k,i.completed[e(l).key]??!1),p(R,`${e(l).label??""} `),p(X,`${e(l).points??""}pt`)}),S(C,y)};W(Q,C=>{e(l).repeatable??!1?C(P):C(F,!1)})}S(c,D)}),t(f),t(r),L(()=>p(d,i.group)),S(a,r),Ve()}pa(["click","input","change"]);var ja=w("<option> </option>"),Ua=w("<p>Loading...</p>"),Xa=w('<p class="error svelte-b2zgdd"> </p>'),Za=w('<p class="muted svelte-b2zgdd"> </p>'),$a=w('<div class="grid svelte-b2zgdd"><div class="left svelte-b2zgdd"></div> <aside class="right svelte-b2zgdd"><section class="card svelte-b2zgdd"><h2>Summary</h2> <div class="kv svelte-b2zgdd"><span>Mobility</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Conditioning</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Strength</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Nutrition</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Miscellaneous</span><span> </span></div> <hr class="svelte-b2zgdd"/> <div class="kv svelte-b2zgdd"><span>Training (capped)</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Lifestyle (capped)</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Total</span><span> </span></div> <hr class="svelte-b2zgdd"/> <div class="kv svelte-b2zgdd"><span>MED met</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Daily win</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Training rating</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Lifestyle rating</span><span> </span></div></section> <section class="card svelte-b2zgdd"><h2>Notes</h2> <textarea class="svelte-b2zgdd"></textarea></section> <button class="save svelte-b2zgdd"> </button> <!> <!></aside></div>'),et=w('<h1>Daily Log</h1> <div class="controls svelte-b2zgdd"><label class="svelte-b2zgdd"><span>Date</span> <input type="date" class="svelte-b2zgdd"/></label> <label class="svelte-b2zgdd"><span>Readiness</span> <select class="svelte-b2zgdd"></select></label></div> <!>',1);function ut(a,i){Je(i,!1);const m=()=>Fa(Ra,"$page",b),[b,_]=qa(),r=K(),h=["fatigued","normal","good"];let d=K(Ta(new Date)),f=K("normal"),c=K({}),l=K({}),D=K(""),Q=K(!1),P=K(!1),F=K(null),C=K(null),y=null,A=!1,k="",M=!1;const R=Array.from(new Set(Fe.map(o=>o.group)));function H(){return JSON.stringify({date:e(d),readiness:e(f),completed:e(c),counts:e(l),notes:e(D)})}async function J(o){u(Q,!0);try{const v=await La(o);M=!0,v?(u(f,v.readiness),u(c,v.completed??{}),u(l,v.counts??{}),u(D,v.notes??""),u(F,v.updatedAt),k=JSON.stringify({date:v.date,readiness:v.readiness,completed:v.completed,counts:v.counts,notes:v.notes})):(u(f,"normal"),u(c,{}),u(l,{}),u(D,""),u(F,null),k=JSON.stringify({date:o,readiness:"normal",completed:{},counts:{},notes:""})),u(C,null)}finally{u(Q,!1)}}async function G(o){if(e(P)){A=A||o==="autosave";return}u(C,null),u(P,!0);try{const v=await Aa({date:e(d),readiness:e(f),completed:e(c),counts:e(l),notes:e(D)});u(F,v.updatedAt),k=H()}catch(v){u(C,v instanceof Error?v.message:"Failed to save.")}finally{u(P,!1),A&&(A=!1,q())}}function X(o,v){u(c,{...e(c),[o]:v})}function E(o,v){const N=Number.isFinite(v)?Math.max(0,Math.floor(v)):0;u(l,{...e(l),[o]:N})}function q(){if(e(Q))return;if(M){M=!1;return}H()!==k&&(y&&clearTimeout(y),y=setTimeout(()=>{y=null,G("autosave")},650))}function Z(){G("manual")}function $(o){return Fe.filter(v=>v.group===o)}Ca(()=>{J(e(d))});let V=K(null);re(()=>m(),()=>{const o=m().url.searchParams.get("date");o&&u(d,o)}),re(()=>(e(d),e(f),e(c),e(l),e(D)),()=>{u(r,Ka({date:e(d),readiness:e(f),completed:e(c),counts:e(l),notes:e(D)}))}),re(()=>{},()=>{q()}),re(()=>(e(V),e(d)),()=>{e(V)!==e(d)&&typeof window<"u"&&(u(V,e(d)),J(e(d)))}),wa(),ba();var I=et(),Y=n(Ge(I),2),x=s(Y),B=n(s(x),2);xe(B),t(x);var j=n(x,2),ne=n(s(j),2);L(()=>{e(f),Da(()=>{})}),he(ne,5,()=>h,o=>o,(o,v)=>{var N=ja(),se=s(N,!0);t(N);var U={};L(()=>{p(se,e(v)),U!==(U=e(v))&&(N.value=(N.__value=e(v))??"")}),S(o,N)}),t(ne),t(j),t(Y);var He=n(Y,2);{var Ye=o=>{var v=Ua();S(o,v)},je=o=>{var v=$a(),N=s(v);he(N,5,()=>R,z=>z,(z,T)=>{{let ae=Ma(()=>(e(T),g(()=>$(e(T)))));Ya(z,{get group(){return e(T)},get activities(){return e(ae)},get completed(){return e(c)},get counts(){return e(l)},onToggle:X,onCountChange:E})}}),t(N);var se=n(N,2),U=s(se),le=n(s(U),2),ze=n(s(le)),Ue=s(ze,!0);t(ze),t(le);var ie=n(le,2),Se=n(s(ie)),Xe=s(Se,!0);t(Se),t(ie);var ve=n(ie,2),Ce=n(s(ve)),Ze=s(Ce,!0);t(Ce),t(ve);var oe=n(ve,2),we=n(s(oe)),$e=s(we,!0);t(we),t(oe);var de=n(oe,2),De=n(s(de)),ea=s(De,!0);t(De),t(de);var ue=n(de,4),Me=n(s(ue)),aa=s(Me,!0);t(Me),t(ue);var ce=n(ue,2),Ne=n(s(ce)),ta=s(Ne,!0);t(Ne),t(ce);var pe=n(ce,2),Te=n(s(pe)),sa=s(Te,!0);t(Te),t(pe);var _e=n(pe,4),Ke=n(s(_e)),ra=s(Ke,!0);t(Ke),t(_e);var fe=n(_e,2),Le=n(s(fe)),na=s(Le,!0);t(Le),t(fe);var be=n(fe,2),Ae=n(s(be)),la=s(Ae,!0);t(Ae),t(be);var Be=n(be,2),Ee=n(s(Be)),ia=s(Ee,!0);t(Ee),t(Be),t(U);var ge=n(U,2),me=n(s(ge),2);Na(me),We(me,"rows",6),t(ge);var ee=n(ge,2),va=s(ee,!0);t(ee);var qe=n(ee,2);{var oa=z=>{var T=Xa(),ae=s(T,!0);t(T),L(()=>p(ae,e(C))),S(z,T)};W(qe,z=>{e(C)&&z(oa)})}var da=n(qe,2);{var ua=z=>{var T=Za(),ae=s(T);t(T),L(ca=>p(ae,`Saved ${ca??""}`),[()=>(e(F),g(()=>new Date(e(F)).toLocaleString()))]),S(z,T)};W(da,z=>{e(F)&&z(ua)})}t(se),t(v),L(()=>{p(Ue,(e(r),g(()=>e(r).rawByCategory.mobility))),p(Xe,(e(r),g(()=>e(r).rawByCategory.conditioning))),p(Ze,(e(r),g(()=>e(r).rawByCategory.strength))),p($e,(e(r),g(()=>e(r).rawByCategory.nutrition))),p(ea,(e(r),g(()=>e(r).rawByCategory.miscellaneous))),p(aa,(e(r),g(()=>e(r).cappedTrainingPoints))),p(ta,(e(r),g(()=>e(r).cappedLifestylePoints))),p(sa,(e(r),g(()=>e(r).totalPoints))),p(ra,(e(r),g(()=>e(r).medMet?"yes":"no"))),p(na,(e(r),g(()=>e(r).dailyWin?"yes":"no"))),p(la,(e(r),g(()=>e(r).trainingRating))),p(ia,(e(r),g(()=>e(r).lifestyleRating))),ee.disabled=e(P),p(va,e(P)?"Saving...":"Save")}),Ie(me,()=>e(D),z=>u(D,z)),fa("click",ee,Z),S(o,v)};W(He,o=>{e(Q)?o(Ye):o(je,!1)})}Ie(B,()=>e(d),o=>u(d,o)),Pa(ne,()=>e(f),o=>u(f,o)),S(a,I),Ve(),_()}export{ut as component};
