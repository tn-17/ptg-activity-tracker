import{f as N,c as Da,a as L}from"../chunks/DcfGaW49.js";import{i as Na}from"../chunks/CZvVAo7f.js";import{aK as $e,aL as Ca,t as wa,aM as Ea,aN as Aa,aO as Ra,V as O,aP as ea,aQ as Ma,u as y,ai as Ia,x as Ba,p as aa,K as s,O as t,H as r,I as ta,c as e,J as A,a as sa,v as E,o as Ka,R as ie,T as Fa,s as u,aR as qa,U as Z,e as Pa,aS as Oa}from"../chunks/QHsq6-My.js";import{s as p}from"../chunks/Bu0Oie1f.js";import{i as W}from"../chunks/DDK3JoqH.js";import{e as De,i as We,A as Qe,c as Ga,a as Va,u as Ja,f as j,R as Ye,T as He,L as Ze}from"../chunks/BFnZqG6b.js";import{r as Ne,s as na,a as Ua,b as Wa}from"../chunks/C3auqD6t.js";import{d as Qa,e as ve}from"../chunks/9GAoCIU5.js";import{s as Ya,a as Ha}from"../chunks/i3zO5i4S.js";import{g as Za}from"../chunks/CxZ1a1wa.js";import{s as je,p as ja}from"../chunks/CA9tYK8k.js";import{p as Xa}from"../chunks/Cyk_RslH.js";function ra(a,o,k=!1){if(a.multiple){if(o==null)return;if(!Ea(o))return Aa();for(var g of a.options)g.selected=o.includes(re(g));return}for(g of a.options){var _=re(g);if(Ra(_,o)){g.selected=!0;return}}(!k||o!==void 0)&&(a.selectedIndex=-1)}function $a(a){var o=new MutationObserver(()=>{ra(a,a.__value)});o.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),wa(()=>{o.disconnect()})}function et(a,o,k=o){var g=new WeakSet,_=!0;$e(a,"change",n=>{var S=n?"[selected]":":checked",d;if(a.multiple)d=[].map.call(a.querySelectorAll(S),re);else{var f=a.querySelector(S)??a.querySelector("option:not([disabled])");d=f&&re(f)}k(d),O!==null&&g.add(O)}),Ca(()=>{var n=o();if(a===document.activeElement){var S=ea??O;if(g.has(S))return}if(ra(a,n,_),_&&n===void 0){var d=a.querySelector(":checked");d!==null&&(n=re(d),k(n))}a.__value=n,_=!1}),$a(a)}function re(a){return"__value"in a?a.__value:a.value}function Xe(a,o,k=o){var g=new WeakSet;$e(a,"input",async _=>{var n=_?a.defaultValue:a.value;if(n=Te(a)?Le(n):n,k(n),O!==null&&g.add(O),await Ma(),n!==(n=o())){var S=a.selectionStart,d=a.selectionEnd,f=a.value.length;if(a.value=n??"",d!==null){var c=a.value.length;S===d&&d===f&&c>f?(a.selectionStart=c,a.selectionEnd=c):(a.selectionStart=S,a.selectionEnd=Math.min(d,c))}}}),(Ba&&a.defaultValue!==a.value||y(o)==null&&a.value)&&(k(Te(a)?Le(a.value):a.value),O!==null&&g.add(O)),Ia(()=>{var _=o();if(a===document.activeElement){var n=ea??O;if(g.has(n))return}Te(a)&&_===Le(a.value)||a.type==="date"&&!_&&!a.value||_!==a.value&&(a.value=_??"")})}function Te(a){var o=a.type;return o==="number"||o==="range"}function Le(a){return a===""?null:+a}var at=N('<span class="meta svelte-at7k0o"> </span>'),tt=N('<span class="reason svelte-at7k0o"> </span>'),st=N('<div><div class="main svelte-at7k0o"><div class="label svelte-at7k0o"><span> </span> <!> <!></div> <span class="points svelte-at7k0o"> </span></div> <div class="counter svelte-at7k0o"><button type="button" class="step svelte-at7k0o">-</button> <input type="number" min="0" inputmode="numeric" class="svelte-at7k0o"/> <button type="button" class="step svelte-at7k0o">+</button></div></div>'),nt=N('<span class="reason svelte-at7k0o"> </span>'),rt=N('<label><input type="checkbox" class="svelte-at7k0o"/> <span class="label svelte-at7k0o"> <!></span> <span class="points svelte-at7k0o"> </span></label>'),lt=N('<section class="group svelte-at7k0o"><h2 class="svelte-at7k0o"> </h2> <div class="items svelte-at7k0o"></div></section>');function it(a,o){aa(o,!0);let k=Xa(o,"counts",19,()=>({}));function g(c){const l=typeof c=="number"?c:Number(c);return Number.isFinite(l)?Math.max(0,Math.floor(l)):0}function _(c,l){o.onCountChange(c,g(l))}var n=lt(),S=s(n),d=s(S,!0);t(S);var f=r(S,2);De(f,21,()=>o.activities,c=>c.key,(c,l)=>{var C=Da(),Q=ta(C);{var G=D=>{var b=st();let R;var h=s(b),w=s(h),q=s(w),V=s(q,!0);t(q);var J=r(q,2);{var P=z=>{var M=at(),U=s(M);t(M),A(()=>p(U,`${e(l).durationMinutes??""}m`)),L(z,M)};W(J,z=>{e(l).durationMinutes&&z(P)})}var X=r(J,2);{var I=z=>{var M=tt(),U=s(M);t(M),A(()=>p(U,`(${o.disabledReasonByKey[e(l).key]??""})`)),L(z,M)};W(X,z=>{o.disabledReasonByKey?.[e(l).key]&&z(I)})}t(w);var B=r(w,2),$=s(B);t(B),t(h);var ee=r(h,2),Y=s(ee);Y.__click=()=>_(e(l).key,(k()?.[e(l).key]??0)-1);var K=r(Y,2);Ne(K),K.__input=z=>_(e(l).key,Number(z.currentTarget.value));var ae=r(K,2);ae.__click=()=>_(e(l).key,(k()?.[e(l).key]??0)+1),t(ee),t(b),A(()=>{R=je(b,1,"item repeatable svelte-at7k0o",null,R,{disabled:o.disabledKeys?.[e(l).key]??!1}),p(V,e(l).label),p($,`${e(l).points??""}pt ea`),na(ee,"aria-label",`Count for ${e(l).label}`),Y.disabled=o.disabledKeys?.[e(l).key]??!1,K.disabled=o.disabledKeys?.[e(l).key]??!1,Ua(K,k()?.[e(l).key]??0),ae.disabled=o.disabledKeys?.[e(l).key]??!1}),L(D,b)},F=D=>{var b=rt();let R;var h=s(b);Ne(h),h.__change=I=>o.onToggle(e(l).key,I.currentTarget.checked);var w=r(h,2),q=s(w),V=r(q);{var J=I=>{var B=nt(),$=s(B);t(B),A(()=>p($,`(${o.disabledReasonByKey[e(l).key]??""})`)),L(I,B)};W(V,I=>{o.disabledReasonByKey?.[e(l).key]&&I(J)})}t(w);var P=r(w,2),X=s(P);t(P),t(b),A(()=>{R=je(b,1,"item svelte-at7k0o",null,R,{disabled:o.disabledKeys?.[e(l).key]??!1}),h.disabled=o.disabledKeys?.[e(l).key]??!1,Wa(h,o.completed[e(l).key]??!1),p(q,`${e(l).label??""} `),p(X,`${e(l).points??""}pt`)}),L(D,b)};W(Q,D=>{e(l).repeatable??!1?D(G):D(F,!1)})}L(c,C)}),t(f),t(n),A(()=>p(d,o.group)),L(a,n),sa()}Qa(["click","input","change"]);var vt=N("<option> </option>"),ot=N("<p>Loading...</p>"),dt=N('<p class="error svelte-b2zgdd"> </p>'),ut=N('<p class="muted svelte-b2zgdd"> </p>'),ct=N('<div class="grid svelte-b2zgdd"><div class="left svelte-b2zgdd"></div> <aside class="right svelte-b2zgdd"><section class="card svelte-b2zgdd"><h2 class="svelte-b2zgdd">Summary</h2> <div class="kv svelte-b2zgdd"><span>Mobility</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Conditioning</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Strength</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Nutrition</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Miscellaneous</span><span> </span></div> <hr class="svelte-b2zgdd"/> <div class="kv svelte-b2zgdd"><span>Training (capped)</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Lifestyle (capped)</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Total</span><span> </span></div> <hr class="svelte-b2zgdd"/> <div class="kv svelte-b2zgdd"><span>MED met</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Daily win</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Training rating</span> <span> </span></div> <div class="kv svelte-b2zgdd"><span>Lifestyle rating</span> <span> </span></div></section> <section class="card svelte-b2zgdd"><h2 class="svelte-b2zgdd">Notes</h2> <textarea class="svelte-b2zgdd"></textarea></section> <button class="save svelte-b2zgdd"> </button> <!> <!></aside></div>'),pt=N('<h1>Daily Log</h1> <div class="controls svelte-b2zgdd"><div class="dateControl svelte-b2zgdd"><label class="svelte-b2zgdd"><span class="svelte-b2zgdd">Date</span> <input type="date" class="svelte-b2zgdd"/></label> <div class="dateNav svelte-b2zgdd" aria-label="Day navigation"><button type="button" class="ghost svelte-b2zgdd">Prev</button> <button type="button" class="ghost svelte-b2zgdd">Next</button></div></div> <label class="svelte-b2zgdd"><span class="svelte-b2zgdd">Readiness</span> <select class="svelte-b2zgdd"></select></label></div> <!>',1);function Lt(a,o){aa(o,!1);const k=()=>Ha(ja,"$page",g),[g,_]=Ya(),n=E(),S=["fatigued","normal","good"];let d=E(We(new Date)),f=E("normal"),c=E({}),l=E({}),C=E(""),Q=E(!1),G=E(!1),F=E(null),D=E(null),b=null,R=!1,h="",w=!1;const q=Array.from(new Set(Qe.map(i=>i.group)));function V(){return JSON.stringify({date:e(d),readiness:e(f),completed:e(c),counts:e(l),notes:e(C)})}async function J(i){u(Q,!0);try{const v=await Va(i);w=!0,v?(u(f,v.readiness),u(c,v.completed??{}),u(l,v.counts??{}),u(C,v.notes??""),u(F,v.updatedAt),h=JSON.stringify({date:v.date,readiness:v.readiness,completed:v.completed,counts:v.counts,notes:v.notes})):(u(f,"normal"),u(c,{}),u(l,{}),u(C,""),u(F,null),h=JSON.stringify({date:i,readiness:"normal",completed:{},counts:{},notes:""})),u(D,null)}finally{u(Q,!1)}}async function P(i){if(e(G)){R=R||i==="autosave";return}u(D,null),u(G,!0);try{const v=await Ja({date:e(d),readiness:e(f),completed:e(c),counts:e(l),notes:e(C)});u(F,v.updatedAt),h=V()}catch(v){u(D,v instanceof Error?v.message:"Failed to save.")}finally{u(G,!1),R&&(R=!1,B())}}function X(i,v){u(c,{...e(c),[i]:v})}function I(i,v){const m=Number.isFinite(v)?Math.max(0,Math.floor(v)):0;u(l,{...e(l),[i]:m})}function B(){if(e(Q))return;if(w){w=!1;return}V()!==h&&(b&&clearTimeout(b),b=setTimeout(()=>{b=null,P("autosave")},500))}function $(){P("manual")}function ee(i){return Qe.filter(v=>v.group===i)}function Y(i,v){const m=new Date(`${i}T12:00:00.000Z`);return Number.isFinite(m.getTime())?(m.setUTCDate(m.getUTCDate()+v),We(m)):i}async function K(){b&&(clearTimeout(b),b=null),V()!==h&&await P("manual")}async function ae(i){await K();const v=new URL(k().url);v.searchParams.set("date",i),Za(v.pathname+v.search,{replaceState:!1,keepFocus:!0,noScroll:!0})}Ka(()=>{J(e(d));const i=()=>{document.visibilityState!=="visible"&&K()};return document.addEventListener("visibilitychange",i),()=>{document.removeEventListener("visibilitychange",i)}});let z=E(null);ie(()=>k(),()=>{const i=k().url.searchParams.get("date");i&&u(d,i)}),ie(()=>(e(d),e(f),e(c),e(l),e(C)),()=>{u(n,Ga({date:e(d),readiness:e(f),completed:e(c),counts:e(l),notes:e(C)}))}),ie(()=>{},()=>{B()}),ie(()=>(e(z),e(d)),()=>{e(z)!==e(d)&&typeof window<"u"&&(u(z,e(d)),J(e(d)))}),Fa(),Na();var M=pt(),U=r(ta(M),2),oe=s(U),de=s(oe),ue=r(s(de),2);Ne(ue),t(de);var Ce=r(de,2),we=s(Ce),la=r(we,2);t(Ce),t(oe);var Ee=r(oe,2),ce=r(s(Ee),2);A(()=>{e(f),qa(()=>{})}),De(ce,5,()=>S,i=>i,(i,v)=>{var m=vt(),le=s(m,!0);t(m);var H={};A(te=>{p(le,te),H!==(H=e(v))&&(m.value=(m.__value=e(v))??"")},[()=>(Z(j),Z(Ye),e(v),y(()=>j(Ye[e(v)])))]),L(i,m)}),t(ce),t(Ee),t(U);var ia=r(U,2);{var va=i=>{var v=ot();L(i,v)},oa=i=>{var v=ct(),m=s(v);De(m,5,()=>q,x=>x,(x,T)=>{{let ne=Pa(()=>(e(T),y(()=>ee(e(T)))));it(x,{get group(){return e(T)},get activities(){return e(ne)},get completed(){return e(c)},get counts(){return e(l)},onToggle:X,onCountChange:I})}}),t(m);var le=r(m,2),H=s(le),te=r(s(H),2),Ae=r(s(te)),da=s(Ae,!0);t(Ae),t(te);var pe=r(te,2),Re=r(s(pe)),ua=s(Re,!0);t(Re),t(pe);var _e=r(pe,2),Me=r(s(_e)),ca=s(Me,!0);t(Me),t(_e);var fe=r(_e,2),Ie=r(s(fe)),pa=s(Ie,!0);t(Ie),t(fe);var be=r(fe,2),Be=r(s(be)),_a=s(Be,!0);t(Be),t(be);var ge=r(be,4),Ke=r(s(ge)),fa=s(Ke,!0);t(Ke),t(ge);var me=r(ge,2),Fe=r(s(me)),ba=s(Fe,!0);t(Fe),t(me);var ye=r(me,2),qe=r(s(ye)),ga=s(qe,!0);t(qe),t(ye);var ke=r(ye,4),Pe=r(s(ke)),ma=s(Pe,!0);t(Pe),t(ke);var he=r(ke,2),Oe=r(s(he)),ya=s(Oe,!0);t(Oe),t(he);var xe=r(he,2),Ge=r(s(xe),2),ka=s(Ge,!0);t(Ge),t(xe);var Ve=r(xe,2),Je=r(s(Ve),2),ha=s(Je,!0);t(Je),t(Ve),t(H);var Se=r(H,2),ze=r(s(Se),2);Oa(ze),na(ze,"rows",6),t(Se);var se=r(Se,2),xa=s(se,!0);t(se);var Ue=r(se,2);{var Sa=x=>{var T=dt(),ne=s(T,!0);t(T),A(()=>p(ne,e(D))),L(x,T)};W(Ue,x=>{e(D)&&x(Sa)})}var za=r(Ue,2);{var Ta=x=>{var T=ut(),ne=s(T);t(T),A(La=>p(ne,`Saved ${La??""}`),[()=>(e(F),y(()=>new Date(e(F)).toLocaleString()))]),L(x,T)};W(za,x=>{e(F)&&x(Ta)})}t(le),t(v),A((x,T)=>{p(da,(e(n),y(()=>e(n).rawByCategory.mobility))),p(ua,(e(n),y(()=>e(n).rawByCategory.conditioning))),p(ca,(e(n),y(()=>e(n).rawByCategory.strength))),p(pa,(e(n),y(()=>e(n).rawByCategory.nutrition))),p(_a,(e(n),y(()=>e(n).rawByCategory.miscellaneous))),p(fa,(e(n),y(()=>e(n).cappedTrainingPoints))),p(ba,(e(n),y(()=>e(n).cappedLifestylePoints))),p(ga,(e(n),y(()=>e(n).totalPoints))),p(ma,(e(n),y(()=>e(n).medMet?"yes":"no"))),p(ya,(e(n),y(()=>e(n).dailyWin?"yes":"no"))),p(ka,x),p(ha,T),se.disabled=e(G),p(xa,e(G)?"Saving...":"Save")},[()=>(Z(j),Z(He),e(n),y(()=>j(He[e(n).trainingRating]))),()=>(Z(j),Z(Ze),e(n),y(()=>j(Ze[e(n).lifestyleRating])))]),Xe(ze,()=>e(C),x=>u(C,x)),ve("click",se,$),L(i,v)};W(ia,i=>{e(Q)?i(va):i(oa,!1)})}Xe(ue,()=>e(d),i=>u(d,i)),ve("change",ue,()=>{K()}),ve("click",we,()=>ae(Y(e(d),-1))),ve("click",la,()=>ae(Y(e(d),1))),et(ce,()=>e(f),i=>u(f,i)),L(a,M),sa(),_()}export{Lt as component};
