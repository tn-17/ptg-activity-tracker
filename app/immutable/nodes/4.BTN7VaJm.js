import{f as D,c as wa,a as T}from"../chunks/DcfGaW49.js";import{i as Da}from"../chunks/CZvVAo7f.js";import{aK as $e,aL as Na,t as Ca,aM as Ea,aN as Aa,aO as Ra,V as O,aP as ea,aQ as Ma,u as y,ai as Ia,x as Ba,p as aa,K as s,O as t,H as r,I as ta,c as e,J as A,a as sa,v as E,o as Ka,R as le,T as Fa,s as u,aR as Pa,U as Z,e as qa,aS as Oa}from"../chunks/QHsq6-My.js";import{s as p}from"../chunks/Bu0Oie1f.js";import{i as W}from"../chunks/DDK3JoqH.js";import{e as we,i as We,A as He,c as Ga,a as Va,u as Ja,f as j,R as Qe,T as Ye,L as Ze}from"../chunks/BFnZqG6b.js";import{r as De,s as na,a as Ua,b as Wa}from"../chunks/C3auqD6t.js";import{d as Ha,e as ve}from"../chunks/9GAoCIU5.js";import{s as Qa,a as Ya}from"../chunks/i3zO5i4S.js";import{g as Za}from"../chunks/Ccj49cdP.js";import{s as je,p as ja}from"../chunks/BiyIv8NM.js";import{p as Xa}from"../chunks/Cyk_RslH.js";function ra(a,o,k=!1){if(a.multiple){if(o==null)return;if(!Ea(o))return Aa();for(var g of a.options)g.selected=o.includes(re(g));return}for(g of a.options){var _=re(g);if(Ra(_,o)){g.selected=!0;return}}(!k||o!==void 0)&&(a.selectedIndex=-1)}function $a(a){var o=new MutationObserver(()=>{ra(a,a.__value)});o.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ca(()=>{o.disconnect()})}function et(a,o,k=o){var g=new WeakSet,_=!0;$e(a,"change",n=>{var S=n?"[selected]":":checked",d;if(a.multiple)d=[].map.call(a.querySelectorAll(S),re);else{var f=a.querySelector(S)??a.querySelector("option:not([disabled])");d=f&&re(f)}k(d),O!==null&&g.add(O)}),Na(()=>{var n=o();if(a===document.activeElement){var S=ea??O;if(g.has(S))return}if(ra(a,n,_),_&&n===void 0){var d=a.querySelector(":checked");d!==null&&(n=re(d),k(n))}a.__value=n,_=!1}),$a(a)}function re(a){return"__value"in a?a.__value:a.value}function Xe(a,o,k=o){var g=new WeakSet;$e(a,"input",async _=>{var n=_?a.defaultValue:a.value;if(n=Le(a)?Te(n):n,k(n),O!==null&&g.add(O),await Ma(),n!==(n=o())){var S=a.selectionStart,d=a.selectionEnd,f=a.value.length;if(a.value=n??"",d!==null){var c=a.value.length;S===d&&d===f&&c>f?(a.selectionStart=c,a.selectionEnd=c):(a.selectionStart=S,a.selectionEnd=Math.min(d,c))}}}),(Ba&&a.defaultValue!==a.value||y(o)==null&&a.value)&&(k(Le(a)?Te(a.value):a.value),O!==null&&g.add(O)),Ia(()=>{var _=o();if(a===document.activeElement){var n=ea??O;if(g.has(n))return}Le(a)&&_===Te(a.value)||a.type==="date"&&!_&&!a.value||_!==a.value&&(a.value=_??"")})}function Le(a){var o=a.type;return o==="number"||o==="range"}function Te(a){return a===""?null:+a}var at=D('<span class="meta svelte-at7k0o"> </span>'),tt=D('<span class="reason svelte-at7k0o"> </span>'),st=D('<div><div class="main svelte-at7k0o"><div class="label svelte-at7k0o"><span> </span> <!> <!></div> <span class="points svelte-at7k0o"> </span></div> <div class="counter svelte-at7k0o"><button type="button" class="step svelte-at7k0o">-</button> <input type="number" min="0" inputmode="numeric" class="svelte-at7k0o"/> <button type="button" class="step svelte-at7k0o">+</button></div></div>'),nt=D('<span class="reason svelte-at7k0o"> </span>'),rt=D('<label><input type="checkbox" class="svelte-at7k0o"/> <span class="label svelte-at7k0o"> <!></span> <span class="points svelte-at7k0o"> </span></label>'),it=D('<section class="group svelte-at7k0o"><h2 class="svelte-at7k0o"> </h2> <div class="items svelte-at7k0o"></div></section>');function lt(a,o){aa(o,!0);let k=Xa(o,"counts",19,()=>({}));function g(c){const l=typeof c=="number"?c:Number(c);return Number.isFinite(l)?Math.max(0,Math.floor(l)):0}function _(c,l){o.onCountChange(c,g(l))}var n=it(),S=s(n),d=s(S,!0);t(S);var f=r(S,2);we(f,21,()=>o.activities,c=>c.key,(c,l)=>{var N=wa(),H=ta(N);{var G=w=>{var b=st();let R;var h=s(b),C=s(h),P=s(C),V=s(P,!0);t(P);var J=r(P,2);{var q=z=>{var I=at(),U=s(I);t(I),A(()=>p(U,`${e(l).durationMinutes??""}m`)),T(z,I)};W(J,z=>{e(l).durationMinutes&&z(q)})}var X=r(J,2);{var B=z=>{var I=tt(),U=s(I);t(I),A(()=>p(U,`(${o.disabledReasonByKey[e(l).key]??""})`)),T(z,I)};W(X,z=>{o.disabledReasonByKey?.[e(l).key]&&z(B)})}t(C);var K=r(C,2),$=s(K);t(K),t(h);var ee=r(h,2),Q=s(ee);Q.__click=()=>_(e(l).key,(k()?.[e(l).key]??0)-1);var M=r(Q,2);De(M),M.__input=z=>_(e(l).key,Number(z.currentTarget.value));var ae=r(M,2);ae.__click=()=>_(e(l).key,(k()?.[e(l).key]??0)+1),t(ee),t(b),A(()=>{R=je(b,1,"item repeatable svelte-at7k0o",null,R,{disabled:o.disabledKeys?.[e(l).key]??!1}),p(V,e(l).label),p($,`${e(l).points??""}pt ea`),na(ee,"aria-label",`Count for ${e(l).label}`),Q.disabled=o.disabledKeys?.[e(l).key]??!1,M.disabled=o.disabledKeys?.[e(l).key]??!1,Ua(M,k()?.[e(l).key]??0),ae.disabled=o.disabledKeys?.[e(l).key]??!1}),T(w,b)},F=w=>{var b=rt();let R;var h=s(b);De(h),h.__change=B=>o.onToggle(e(l).key,B.currentTarget.checked);var C=r(h,2),P=s(C),V=r(P);{var J=B=>{var K=nt(),$=s(K);t(K),A(()=>p($,`(${o.disabledReasonByKey[e(l).key]??""})`)),T(B,K)};W(V,B=>{o.disabledReasonByKey?.[e(l).key]&&B(J)})}t(C);var q=r(C,2),X=s(q);t(q),t(b),A(()=>{R=je(b,1,"item svelte-at7k0o",null,R,{disabled:o.disabledKeys?.[e(l).key]??!1}),h.disabled=o.disabledKeys?.[e(l).key]??!1,Wa(h,o.completed[e(l).key]??!1),p(P,`${e(l).label??""} `),p(X,`${e(l).points??""}pt`)}),T(w,b)};W(H,w=>{e(l).repeatable??!1?w(G):w(F,!1)})}T(c,N)}),t(f),t(n),A(()=>p(d,o.group)),T(a,n),sa()}Ha(["click","input","change"]);var vt=D("<option> </option>"),ot=D("<p>Loading...</p>"),dt=D('<p class="error svelte-b2zgdd"> </p>'),ut=D('<p class="muted svelte-b2zgdd"> </p>'),ct=D('<div class="grid svelte-b2zgdd"><div class="left svelte-b2zgdd"></div> <aside class="right svelte-b2zgdd"><section class="card svelte-b2zgdd"><h2 class="svelte-b2zgdd">Summary</h2> <div class="kv svelte-b2zgdd"><span>Mobility</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Conditioning</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Strength</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Nutrition</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Miscellaneous</span><span> </span></div> <hr class="svelte-b2zgdd"/> <div class="kv svelte-b2zgdd"><span>Training (capped)</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Lifestyle (capped)</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Total</span><span> </span></div> <hr class="svelte-b2zgdd"/> <div class="kv svelte-b2zgdd"><span>MED met</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Daily win</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Training rating</span> <span> </span></div> <div class="kv svelte-b2zgdd"><span>Lifestyle rating</span> <span> </span></div></section> <section class="card svelte-b2zgdd"><h2 class="svelte-b2zgdd">Notes</h2> <textarea class="svelte-b2zgdd"></textarea></section> <button class="save svelte-b2zgdd"> </button> <!> <!></aside></div>'),pt=D('<h1>Daily Log</h1> <div class="controls svelte-b2zgdd"><div class="dateControl svelte-b2zgdd"><label class="svelte-b2zgdd"><span class="svelte-b2zgdd">Date</span> <input type="date" class="svelte-b2zgdd"/></label> <div class="dateNav svelte-b2zgdd" aria-label="Day navigation"><button type="button" class="ghost svelte-b2zgdd">Prev</button> <button type="button" class="ghost svelte-b2zgdd">Next</button></div></div> <label class="svelte-b2zgdd"><span class="svelte-b2zgdd">Readiness</span> <select class="svelte-b2zgdd"></select></label></div> <!>',1);function Tt(a,o){aa(o,!1);const k=()=>Ya(ja,"$page",g),[g,_]=Qa(),n=E(),S=["fatigued","normal","good"];let d=E(We(new Date)),f=E("normal"),c=E({}),l=E({}),N=E(""),H=E(!1),G=E(!1),F=E(null),w=E(null),b=null,R=!1,h="",C=!1;const P=Array.from(new Set(He.map(v=>v.group)));function V(){return JSON.stringify({date:e(d),readiness:e(f),completed:e(c),counts:e(l),notes:e(N)})}async function J(v){u(H,!0);try{const i=await Va(v);C=!0,i?(u(f,i.readiness),u(c,i.completed??{}),u(l,i.counts??{}),u(N,i.notes??""),u(F,i.updatedAt),h=JSON.stringify({date:i.date,readiness:i.readiness,completed:i.completed,counts:i.counts,notes:i.notes})):(u(f,"normal"),u(c,{}),u(l,{}),u(N,""),u(F,null),h=JSON.stringify({date:v,readiness:"normal",completed:{},counts:{},notes:""})),u(w,null)}finally{u(H,!1)}}async function q(v){if(e(G)){R=R||v==="autosave";return}u(w,null),u(G,!0);try{const i=await Ja({date:e(d),readiness:e(f),completed:e(c),counts:e(l),notes:e(N)});u(F,i.updatedAt),h=V()}catch(i){u(w,i instanceof Error?i.message:"Failed to save.")}finally{u(G,!1),R&&(R=!1,K())}}function X(v,i){u(c,{...e(c),[v]:i})}function B(v,i){const m=Number.isFinite(i)?Math.max(0,Math.floor(i)):0;u(l,{...e(l),[v]:m})}function K(){if(e(H))return;if(C){C=!1;return}V()!==h&&(b&&clearTimeout(b),b=setTimeout(()=>{b=null,q("autosave")},500))}function $(){q("manual")}function ee(v){return He.filter(i=>i.group===v)}function Q(v,i){const m=new Date(`${v}T12:00:00.000Z`);return Number.isFinite(m.getTime())?(m.setUTCDate(m.getUTCDate()+i),We(m)):v}async function M(){b&&(clearTimeout(b),b=null),V()!==h&&await q("manual")}async function ae(v){await M();const i=new URL(k().url);i.searchParams.set("date",v),Za(i.pathname+i.search,{replaceState:!1,keepFocus:!0,noScroll:!0})}Ka(()=>{J(e(d));const v=()=>{document.visibilityState!=="visible"&&M()},i=()=>{M()};return document.addEventListener("visibilitychange",v),window.addEventListener("pagehide",i),()=>{document.removeEventListener("visibilitychange",v),window.removeEventListener("pagehide",i)}});let z=E(null);le(()=>k(),()=>{const v=k().url.searchParams.get("date");v&&u(d,v)}),le(()=>(e(d),e(f),e(c),e(l),e(N)),()=>{u(n,Ga({date:e(d),readiness:e(f),completed:e(c),counts:e(l),notes:e(N)}))}),le(()=>{},()=>{K()}),le(()=>(e(z),e(d)),()=>{e(z)!==e(d)&&typeof window<"u"&&(u(z,e(d)),J(e(d)))}),Fa(),Da();var I=pt(),U=r(ta(I),2),oe=s(U),de=s(oe),ue=r(s(de),2);De(ue),t(de);var Ne=r(de,2),Ce=s(Ne),ia=r(Ce,2);t(Ne),t(oe);var Ee=r(oe,2),ce=r(s(Ee),2);A(()=>{e(f),Pa(()=>{})}),we(ce,5,()=>S,v=>v,(v,i)=>{var m=vt(),ie=s(m,!0);t(m);var Y={};A(te=>{p(ie,te),Y!==(Y=e(i))&&(m.value=(m.__value=e(i))??"")},[()=>(Z(j),Z(Qe),e(i),y(()=>j(Qe[e(i)])))]),T(v,m)}),t(ce),t(Ee),t(U);var la=r(U,2);{var va=v=>{var i=ot();T(v,i)},oa=v=>{var i=ct(),m=s(i);we(m,5,()=>P,x=>x,(x,L)=>{{let ne=qa(()=>(e(L),y(()=>ee(e(L)))));lt(x,{get group(){return e(L)},get activities(){return e(ne)},get completed(){return e(c)},get counts(){return e(l)},onToggle:X,onCountChange:B})}}),t(m);var ie=r(m,2),Y=s(ie),te=r(s(Y),2),Ae=r(s(te)),da=s(Ae,!0);t(Ae),t(te);var pe=r(te,2),Re=r(s(pe)),ua=s(Re,!0);t(Re),t(pe);var _e=r(pe,2),Me=r(s(_e)),ca=s(Me,!0);t(Me),t(_e);var fe=r(_e,2),Ie=r(s(fe)),pa=s(Ie,!0);t(Ie),t(fe);var be=r(fe,2),Be=r(s(be)),_a=s(Be,!0);t(Be),t(be);var ge=r(be,4),Ke=r(s(ge)),fa=s(Ke,!0);t(Ke),t(ge);var me=r(ge,2),Fe=r(s(me)),ba=s(Fe,!0);t(Fe),t(me);var ye=r(me,2),Pe=r(s(ye)),ga=s(Pe,!0);t(Pe),t(ye);var ke=r(ye,4),qe=r(s(ke)),ma=s(qe,!0);t(qe),t(ke);var he=r(ke,2),Oe=r(s(he)),ya=s(Oe,!0);t(Oe),t(he);var xe=r(he,2),Ge=r(s(xe),2),ka=s(Ge,!0);t(Ge),t(xe);var Ve=r(xe,2),Je=r(s(Ve),2),ha=s(Je,!0);t(Je),t(Ve),t(Y);var Se=r(Y,2),ze=r(s(Se),2);Oa(ze),na(ze,"rows",6),t(Se);var se=r(Se,2),xa=s(se,!0);t(se);var Ue=r(se,2);{var Sa=x=>{var L=dt(),ne=s(L,!0);t(L),A(()=>p(ne,e(w))),T(x,L)};W(Ue,x=>{e(w)&&x(Sa)})}var za=r(Ue,2);{var La=x=>{var L=ut(),ne=s(L);t(L),A(Ta=>p(ne,`Saved ${Ta??""}`),[()=>(e(F),y(()=>new Date(e(F)).toLocaleString()))]),T(x,L)};W(za,x=>{e(F)&&x(La)})}t(ie),t(i),A((x,L)=>{p(da,(e(n),y(()=>e(n).rawByCategory.mobility))),p(ua,(e(n),y(()=>e(n).rawByCategory.conditioning))),p(ca,(e(n),y(()=>e(n).rawByCategory.strength))),p(pa,(e(n),y(()=>e(n).rawByCategory.nutrition))),p(_a,(e(n),y(()=>e(n).rawByCategory.miscellaneous))),p(fa,(e(n),y(()=>e(n).cappedTrainingPoints))),p(ba,(e(n),y(()=>e(n).cappedLifestylePoints))),p(ga,(e(n),y(()=>e(n).totalPoints))),p(ma,(e(n),y(()=>e(n).medMet?"yes":"no"))),p(ya,(e(n),y(()=>e(n).dailyWin?"yes":"no"))),p(ka,x),p(ha,L),se.disabled=e(G),p(xa,e(G)?"Saving...":"Save")},[()=>(Z(j),Z(Ye),e(n),y(()=>j(Ye[e(n).trainingRating]))),()=>(Z(j),Z(Ze),e(n),y(()=>j(Ze[e(n).lifestyleRating])))]),Xe(ze,()=>e(N),x=>u(N,x)),ve("click",se,$),T(v,i)};W(la,v=>{e(H)?v(va):v(oa,!1)})}Xe(ue,()=>e(d),v=>u(d,v)),ve("change",ue,()=>{M()}),ve("click",Ce,()=>ae(Q(e(d),-1))),ve("click",ia,()=>ae(Q(e(d),1))),et(ce,()=>e(f),v=>u(f,v)),T(a,I),sa(),_()}export{Tt as component};
