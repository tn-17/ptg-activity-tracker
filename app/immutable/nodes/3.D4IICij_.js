import{f as p,a as l,c as xe,t as be}from"../chunks/DcfGaW49.js";import{i as he}from"../chunks/CZvVAo7f.js";import{p as we,o as De,H as i,I as F,J as y,a as Se,c as e,v as N,s as c,K as n,M as Re,O as r}from"../chunks/QHsq6-My.js";import{s as g}from"../chunks/Bu0Oie1f.js";import{i as S}from"../chunks/DDK3JoqH.js";import{l as Le,g as Ae,e as X,f as Y,R as Ie,T as Ce,d as Ee}from"../chunks/DjNrvxTS.js";import{s as W}from"../chunks/C3auqD6t.js";import{e as J}from"../chunks/9GAoCIU5.js";import{r as K}from"../chunks/CdkEbi57.js";import{c as Ne}from"../chunks/DRlRpw1s.js";var We=p("<p>Loading…</p>"),Be=p("<p>No entries yet. Go to <a>Log</a> to create one.</p>"),Ge=p('<p class="error svelte-1xl2tfr"> </p>'),Te=p('<p class="deload">Deload: yes<!></p>'),Me=p('<p class="deload">Deload: no</p>'),He=p('<div class="confirm svelte-1xl2tfr" role="group"><button type="button" class="delete danger svelte-1xl2tfr"> </button> <button type="button" class="delete svelte-1xl2tfr">Cancel</button></div>'),je=p('<button type="button" class="delete svelte-1xl2tfr" title="Delete">Del</button>'),Fe=p('<div class="rowWrap svelte-1xl2tfr"><a class="row svelte-1xl2tfr"><span class="date"> </span> <span class="meta svelte-1xl2tfr"> </span> <span class="tier svelte-1xl2tfr"> </span> <span class="total svelte-1xl2tfr"> </span></a> <!></div>'),Je=p('<section class="week svelte-1xl2tfr"><h2> </h2> <!> <div class="list svelte-1xl2tfr"></div></section>'),Ke=p("<!> <!>",1),Oe=p('<h1>History</h1> <a class="new svelte-1xl2tfr">New / Today</a> <!>',1);function ea(Z,$){we($,!1);function ee(a){const s={scheduled:"scheduled",fatigued_days:"4+ fatigued days",high_average:"high 3-week average"};return a.map(A=>s[A]).join(", ")}let R=N(!0),T=N([]),B=N(null),h=N(null),L=N(null);function ae(a){const s=new Map;for(const v of a){const o=Ae(v.date),d=s.get(o);d?d.push(v):s.set(o,[v])}const A=Array.from(s.entries()).map(([v,o])=>({weekStart:v,days:o.slice().sort((d,w)=>d.date>w.date?-1:1)})).sort((v,o)=>v.weekStart>o.weekStart?1:-1);return Ne(A).map(v=>({week:v}))}async function O(){c(R,!0);try{const a=await Le(400);c(T,ae(a))}finally{c(R,!1)}}function te(a){c(L,null),c(B,a)}function re(){c(B,null)}async function se(a){if(e(h)!==a){c(L,null),c(h,a);try{await Ee(a),c(B,null),await O()}catch(s){c(L,s instanceof Error?s.message:"Failed to delete log entry.")}finally{c(h,null)}}}De(O),he();var P=Oe(),U=i(F(P),2),oe=i(U,2);{var le=a=>{var s=We();l(a,s)},ne=a=>{var s=xe(),A=F(s);{var q=o=>{var d=Be(),w=i(n(d));Re(),r(d),y(M=>W(w,"href",M),[()=>K("/log")]),l(o,d)},v=o=>{var d=Ke(),w=F(d);{var M=k=>{var _=Ge(),I=n(_,!0);r(_),y(()=>g(I,e(L))),l(k,_)};S(w,k=>{e(L)&&k(M)})}var ie=i(w,2);X(ie,1,()=>e(T),k=>k.week.weekStart,(k,_)=>{var I=Je(),H=n(I),ve=n(H);r(H);var z=i(H,2);{var de=u=>{var t=Te(),C=i(n(t));{var D=x=>{var G=be();y(E=>g(G,`Reasons: ${E??""}`),[()=>ee(e(_).week.deloadReasons)]),l(x,G)};S(C,x=>{e(_).week.deloadReasons.length>0&&x(D)})}r(t),l(u,t)},fe=u=>{var t=Me();l(u,t)};S(z,u=>{e(_).week.deload?u(de):u(fe,!1)})}var Q=i(z,2);X(Q,5,()=>e(_).week.days,u=>u.day.date,(u,t)=>{var C=Fe(),D=n(C),x=n(D),G=n(x,!0);r(x);var E=i(x,2),ce=n(E,!0);r(E);var j=i(E,2),pe=n(j,!0);r(j);var V=i(j,2),ue=n(V,!0);r(V),r(D);var _e=i(D,2);{var me=m=>{var f=He(),b=n(f),ge=n(b,!0);r(b);var ke=i(b,2);r(f),y(()=>{W(f,"aria-label",`Confirm delete for ${e(t).day.date}`),b.disabled=e(h)===e(t).day.date||e(R),g(ge,e(h)===e(t).day.date?"…":"Confirm")}),J("click",b,()=>{se(e(t).day.date)}),J("click",ke,re),l(m,f)},ye=m=>{var f=je();y(()=>{f.disabled=e(h)===e(t).day.date||e(R),W(f,"aria-label",`Delete log entry for ${e(t).day.date}`)}),J("click",f,()=>te(e(t).day.date)),l(m,f)};S(_e,m=>{e(B)===e(t).day.date?m(me):m(ye,!1)})}r(C),y((m,f,b)=>{W(D,"href",m),g(G,e(t).day.date),g(ce,f),g(pe,b),g(ue,e(t).scores.totalPoints)},[()=>K("/log")+`?date=${e(t).day.date}`,()=>Y(Ie[e(t).day.readiness]),()=>Y(Ce[e(t).scores.trainingRating])]),l(u,C)}),r(Q),r(I),y(()=>g(ve,`Week of ${e(_).week.weekStart??""}`)),l(k,I)}),l(o,d)};S(A,o=>{e(T).length===0?o(q):o(v,!1)},!0)}l(a,s)};S(oe,a=>{e(R)?a(le):a(ne,!1)})}y(a=>W(U,"href",a),[()=>K("/log")]),l(Z,P),Se()}export{ea as component};
