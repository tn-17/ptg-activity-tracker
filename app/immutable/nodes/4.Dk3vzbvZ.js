import{f as w,c as pa,a as S}from"../chunks/CT3D-Iho.js";import{i as _a}from"../chunks/BXyBdR38.js";import{aK as Oe,aL as fa,t as ba,aM as ga,aN as ma,aO as ya,U as O,aP as Pe,aQ as ka,u as g,ai as ha,x as xa,p as Je,K as s,O as t,H as n,I as Ve,c as e,J as L,a as We,v as K,o as za,R as re,T as Sa,s as u,aR as Ca,e as wa,aS as Da}from"../chunks/Bbatwou0.js";import{s as p}from"../chunks/DIgocRep.js";import{i as G}from"../chunks/CtOTHBIA.js";import{e as he,i as Ta,A as qe,c as Ma,a as Na,u as Ka}from"../chunks/Dr3jCEEA.js";import{r as xe,s as Ge,a as La,b as Aa}from"../chunks/DLCH2CcZ.js";import{d as Ba,e as Ea}from"../chunks/D7lJB4nl.js";import{s as Ra,a as qa}from"../chunks/Dkq4dWDL.js";import{s as Fe,p as Fa}from"../chunks/BB9L_DZF.js";import{p as Ia}from"../chunks/DyQSHphy.js";function Qe(a,i,m=!1){if(a.multiple){if(i==null)return;if(!ga(i))return ma();for(var b of a.options)b.selected=i.includes(te(b));return}for(b of a.options){var _=te(b);if(ya(_,i)){b.selected=!0;return}}(!m||i!==void 0)&&(a.selectedIndex=-1)}function Oa(a){var i=new MutationObserver(()=>{Qe(a,a.__value)});i.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ba(()=>{i.disconnect()})}function Pa(a,i,m=i){var b=new WeakSet,_=!0;Oe(a,"change",r=>{var h=r?"[selected]":":checked",d;if(a.multiple)d=[].map.call(a.querySelectorAll(h),te);else{var f=a.querySelector(h)??a.querySelector("option:not([disabled])");d=f&&te(f)}m(d),O!==null&&b.add(O)}),fa(()=>{var r=i();if(a===document.activeElement){var h=Pe??O;if(b.has(h))return}if(Qe(a,r,_),_&&r===void 0){var d=a.querySelector(":checked");d!==null&&(r=te(d),m(r))}a.__value=r,_=!1}),Oa(a)}function te(a){return"__value"in a?a.__value:a.value}function Ie(a,i,m=i){var b=new WeakSet;Oe(a,"input",async _=>{var r=_?a.defaultValue:a.value;if(r=ye(a)?ke(r):r,m(r),O!==null&&b.add(O),await ka(),r!==(r=i())){var h=a.selectionStart,d=a.selectionEnd,f=a.value.length;if(a.value=r??"",d!==null){var c=a.value.length;h===d&&d===f&&c>f?(a.selectionStart=c,a.selectionEnd=c):(a.selectionStart=h,a.selectionEnd=Math.min(d,c))}}}),(xa&&a.defaultValue!==a.value||g(i)==null&&a.value)&&(m(ye(a)?ke(a.value):a.value),O!==null&&b.add(O)),ha(()=>{var _=i();if(a===document.activeElement){var r=Pe??O;if(b.has(r))return}ye(a)&&_===ke(a.value)||a.type==="date"&&!_&&!a.value||_!==a.value&&(a.value=_??"")})}function ye(a){var i=a.type;return i==="number"||i==="range"}function ke(a){return a===""?null:+a}var Ja=w('<span class="meta svelte-at7k0o"> </span>'),Va=w('<span class="reason svelte-at7k0o"> </span>'),Wa=w('<div><div class="main svelte-at7k0o"><div class="label svelte-at7k0o"><span> </span> <!> <!></div> <span class="points svelte-at7k0o"> </span></div> <div class="counter svelte-at7k0o"><button type="button" class="step svelte-at7k0o">-</button> <input type="number" min="0" inputmode="numeric" class="svelte-at7k0o"/> <button type="button" class="step svelte-at7k0o">+</button></div></div>'),Ga=w('<span class="reason svelte-at7k0o"> </span>'),Qa=w('<label><input type="checkbox"/> <span class="label svelte-at7k0o"> <!></span> <span class="points svelte-at7k0o"> </span></label>'),Ha=w('<section class="group svelte-at7k0o"><h2> </h2> <div class="items svelte-at7k0o"></div></section>');function Ua(a,i){Je(i,!0);let m=Ia(i,"counts",19,()=>({}));function b(c){const l=typeof c=="number"?c:Number(c);return Number.isFinite(l)?Math.max(0,Math.floor(l)):0}function _(c,l){i.onCountChange(c,b(l))}var r=Ha(),h=s(r),d=s(h,!0);t(h);var f=n(h,2);he(f,21,()=>i.activities,c=>c.key,(c,l)=>{var D=pa(),Q=Ve(D);{var P=C=>{var y=Wa();let A;var k=s(y),T=s(k),F=s(T),H=s(F,!0);t(F);var J=n(F,2);{var V=x=>{var B=Ja(),Y=s(B);t(B),L(()=>p(Y,`${e(l).durationMinutes??""}m`)),S(x,B)};G(J,x=>{e(l).durationMinutes&&x(V)})}var X=n(J,2);{var E=x=>{var B=Va(),Y=s(B);t(B),L(()=>p(Y,`(${i.disabledReasonByKey[e(l).key]??""})`)),S(x,B)};G(X,x=>{i.disabledReasonByKey?.[e(l).key]&&x(E)})}t(T);var R=n(T,2),Z=s(R);t(R),t(k);var $=n(k,2),W=s($);W.__click=()=>_(e(l).key,(m()?.[e(l).key]??0)-1);var I=n(W,2);xe(I),I.__input=x=>_(e(l).key,Number(x.currentTarget.value));var U=n(I,2);U.__click=()=>_(e(l).key,(m()?.[e(l).key]??0)+1),t($),t(y),L(()=>{A=Fe(y,1,"item repeatable svelte-at7k0o",null,A,{disabled:i.disabledKeys?.[e(l).key]??!1}),p(H,e(l).label),p(Z,`${e(l).points??""}pt ea`),Ge($,"aria-label",`Count for ${e(l).label}`),W.disabled=i.disabledKeys?.[e(l).key]??!1,I.disabled=i.disabledKeys?.[e(l).key]??!1,La(I,m()?.[e(l).key]??0),U.disabled=i.disabledKeys?.[e(l).key]??!1}),S(C,y)},q=C=>{var y=Qa();let A;var k=s(y);xe(k),k.__change=E=>i.onToggle(e(l).key,E.currentTarget.checked);var T=n(k,2),F=s(T),H=n(F);{var J=E=>{var R=Ga(),Z=s(R);t(R),L(()=>p(Z,`(${i.disabledReasonByKey[e(l).key]??""})`)),S(E,R)};G(H,E=>{i.disabledReasonByKey?.[e(l).key]&&E(J)})}t(T);var V=n(T,2),X=s(V);t(V),t(y),L(()=>{A=Fe(y,1,"item svelte-at7k0o",null,A,{disabled:i.disabledKeys?.[e(l).key]??!1}),k.disabled=i.disabledKeys?.[e(l).key]??!1,Aa(k,i.completed[e(l).key]??!1),p(F,`${e(l).label??""} `),p(X,`${e(l).points??""}pt`)}),S(C,y)};G(Q,C=>{e(l).repeatable??!1?C(P):C(q,!1)})}S(c,D)}),t(f),t(r),L(()=>p(d,i.group)),S(a,r),We()}Ba(["click","input","change"]);var Ya=w("<option> </option>"),ja=w("<p>Loading...</p>"),Xa=w('<p class="error svelte-b2zgdd"> </p>'),Za=w('<p class="muted svelte-b2zgdd"> </p>'),$a=w('<div class="grid svelte-b2zgdd"><div class="left svelte-b2zgdd"></div> <aside class="right svelte-b2zgdd"><section class="card svelte-b2zgdd"><h2>Summary</h2> <div class="kv svelte-b2zgdd"><span>Mobility</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Conditioning</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Strength</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Nutrition</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Miscellaneous</span><span> </span></div> <hr class="svelte-b2zgdd"/> <div class="kv svelte-b2zgdd"><span>Training (capped)</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Lifestyle (capped)</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Total</span><span> </span></div> <hr class="svelte-b2zgdd"/> <div class="kv svelte-b2zgdd"><span>MED met</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Daily win</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Training rating</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Lifestyle rating</span><span> </span></div></section> <section class="card svelte-b2zgdd"><h2>Notes</h2> <textarea class="svelte-b2zgdd"></textarea></section> <button class="save svelte-b2zgdd"> </button> <!> <!></aside></div>'),et=w('<h1>Daily Log</h1> <div class="controls svelte-b2zgdd"><label class="svelte-b2zgdd"><span>Date</span> <input type="date" class="svelte-b2zgdd"/></label> <label class="svelte-b2zgdd"><span>Readiness</span> <select class="svelte-b2zgdd"></select></label></div> <!>',1);function ct(a,i){Je(i,!1);const m=()=>qa(Fa,"$page",b),[b,_]=Ra(),r=K(),h=["fatigued","normal","good"];let d=K(Ta(new Date)),f=K("normal"),c=K({}),l=K({}),D=K(""),Q=K(!1),P=K(!1),q=K(null),C=K(null),y=null,A=!1,k="",T=!1;const F=Array.from(new Set(qe.map(o=>o.group)));function H(){return JSON.stringify({date:e(d),readiness:e(f),completed:e(c),counts:e(l),notes:e(D)})}async function J(o){u(Q,!0);try{const v=await Na(o);T=!0,v?(u(f,v.readiness),u(c,v.completed??{}),u(l,v.counts??{}),u(D,v.notes??""),u(q,v.updatedAt),k=JSON.stringify({date:v.date,readiness:v.readiness,completed:v.completed,counts:v.counts,notes:v.notes})):(u(f,"normal"),u(c,{}),u(l,{}),u(D,""),u(q,null),k=JSON.stringify({date:o,readiness:"normal",completed:{},counts:{},notes:""})),u(C,null)}finally{u(Q,!1)}}async function V(o){if(e(P)){A=A||o==="autosave";return}u(C,null),u(P,!0);try{const v=await Ka({date:e(d),readiness:e(f),completed:e(c),counts:e(l),notes:e(D)});u(q,v.updatedAt),k=H()}catch(v){u(C,v instanceof Error?v.message:"Failed to save.")}finally{u(P,!1),A&&(A=!1,R())}}function X(o,v){u(c,{...e(c),[o]:v})}function E(o,v){const M=Number.isFinite(v)?Math.max(0,Math.floor(v)):0;u(l,{...e(l),[o]:M})}function R(){if(e(Q))return;if(T){T=!1;return}H()!==k&&(y&&clearTimeout(y),y=setTimeout(()=>{y=null,V("autosave")},650))}function Z(){V("manual")}function $(o){return qe.filter(v=>v.group===o)}za(()=>{J(e(d))});let W=K(null);re(()=>m(),()=>{const o=m().url.searchParams.get("date");o&&u(d,o)}),re(()=>(e(d),e(f),e(c),e(l),e(D)),()=>{u(r,Ma({date:e(d),readiness:e(f),completed:e(c),counts:e(l),notes:e(D)}))}),re(()=>{},()=>{R()}),re(()=>(e(W),e(d)),()=>{e(W)!==e(d)&&typeof window<"u"&&(u(W,e(d)),J(e(d)))}),Sa(),_a();var I=et(),U=n(Ve(I),2),x=s(U),B=n(s(x),2);xe(B),t(x);var Y=n(x,2),ne=n(s(Y),2);L(()=>{e(f),Ca(()=>{})}),he(ne,5,()=>h,o=>o,(o,v)=>{var M=Ya(),se=s(M,!0);t(M);var j={};L(()=>{p(se,e(v)),j!==(j=e(v))&&(M.value=(M.__value=e(v))??"")}),S(o,M)}),t(ne),t(Y),t(U);var He=n(U,2);{var Ue=o=>{var v=ja();S(o,v)},Ye=o=>{var v=$a(),M=s(v);he(M,5,()=>F,z=>z,(z,N)=>{{let ae=wa(()=>(e(N),g(()=>$(e(N)))));Ua(z,{get group(){return e(N)},get activities(){return e(ae)},get completed(){return e(c)},get counts(){return e(l)},onToggle:X,onCountChange:E})}}),t(M);var se=n(M,2),j=s(se),le=n(s(j),2),ze=n(s(le)),je=s(ze,!0);t(ze),t(le);var ie=n(le,2),Se=n(s(ie)),Xe=s(Se,!0);t(Se),t(ie);var ve=n(ie,2),Ce=n(s(ve)),Ze=s(Ce,!0);t(Ce),t(ve);var oe=n(ve,2),we=n(s(oe)),$e=s(we,!0);t(we),t(oe);var de=n(oe,2),De=n(s(de)),ea=s(De,!0);t(De),t(de);var ue=n(de,4),Te=n(s(ue)),aa=s(Te,!0);t(Te),t(ue);var ce=n(ue,2),Me=n(s(ce)),ta=s(Me,!0);t(Me),t(ce);var pe=n(ce,2),Ne=n(s(pe)),sa=s(Ne,!0);t(Ne),t(pe);var _e=n(pe,4),Ke=n(s(_e)),ra=s(Ke,!0);t(Ke),t(_e);var fe=n(_e,2),Le=n(s(fe)),na=s(Le,!0);t(Le),t(fe);var be=n(fe,2),Ae=n(s(be)),la=s(Ae,!0);t(Ae),t(be);var Be=n(be,2),Ee=n(s(Be)),ia=s(Ee,!0);t(Ee),t(Be),t(j);var ge=n(j,2),me=n(s(ge),2);Da(me),Ge(me,"rows",6),t(ge);var ee=n(ge,2),va=s(ee,!0);t(ee);var Re=n(ee,2);{var oa=z=>{var N=Xa(),ae=s(N,!0);t(N),L(()=>p(ae,e(C))),S(z,N)};G(Re,z=>{e(C)&&z(oa)})}var da=n(Re,2);{var ua=z=>{var N=Za(),ae=s(N);t(N),L(ca=>p(ae,`Saved ${ca??""}`),[()=>(e(q),g(()=>new Date(e(q)).toLocaleString()))]),S(z,N)};G(da,z=>{e(q)&&z(ua)})}t(se),t(v),L(()=>{p(je,(e(r),g(()=>e(r).rawByCategory.mobility))),p(Xe,(e(r),g(()=>e(r).rawByCategory.conditioning))),p(Ze,(e(r),g(()=>e(r).rawByCategory.strength))),p($e,(e(r),g(()=>e(r).rawByCategory.nutrition))),p(ea,(e(r),g(()=>e(r).rawByCategory.miscellaneous))),p(aa,(e(r),g(()=>e(r).cappedTrainingPoints))),p(ta,(e(r),g(()=>e(r).cappedLifestylePoints))),p(sa,(e(r),g(()=>e(r).totalPoints))),p(ra,(e(r),g(()=>e(r).medMet?"yes":"no"))),p(na,(e(r),g(()=>e(r).dailyWin?"yes":"no"))),p(la,(e(r),g(()=>e(r).trainingRating))),p(ia,(e(r),g(()=>e(r).lifestyleRating))),ee.disabled=e(P),p(va,e(P)?"Saving...":"Save")}),Ie(me,()=>e(D),z=>u(D,z)),Ea("click",ee,Z),S(o,v)};G(He,o=>{e(Q)?o(Ue):o(Ye,!1)})}Ie(B,()=>e(d),o=>u(d,o)),Pa(ne,()=>e(f),o=>u(f,o)),S(a,I),We(),_()}export{ct as component};
