import{f as N,c as La,a as T}from"../chunks/DcfGaW49.js";import{i as Da}from"../chunks/CZvVAo7f.js";import{aK as Xe,aL as Na,t as Ca,aM as wa,aN as Aa,aO as Ea,V as O,aP as $e,aQ as Ra,u as m,ai as Ma,x as Ia,p as ea,K as s,O as t,H as n,I as aa,c as e,J as R,a as ta,v as E,o as Ba,R as ie,T as Ka,s as u,aR as Fa,U as j,e as qa,aS as Oa}from"../chunks/QHsq6-My.js";import{s as _}from"../chunks/Bu0Oie1f.js";import{i as V}from"../chunks/DDK3JoqH.js";import{e as Te,i as Ve,A as We,c as Pa,a as Ga,u as Ja,f as X,R as Qe,T as Ye,L as He}from"../chunks/BFnZqG6b.js";import{r as Le,s as sa,a as Ua,b as Va}from"../chunks/C3auqD6t.js";import{d as Wa,e as xe}from"../chunks/9GAoCIU5.js";import{s as Qa,a as Ya}from"../chunks/i3zO5i4S.js";import{g as Ha}from"../chunks/DG72yJkt.js";import{s as Ze,p as Za}from"../chunks/KoFC6B37.js";import{p as ja}from"../chunks/Cyk_RslH.js";function ra(a,v,y=!1){if(a.multiple){if(v==null)return;if(!wa(v))return Aa();for(var b of a.options)b.selected=v.includes(ne(b));return}for(b of a.options){var p=ne(b);if(Ea(p,v)){b.selected=!0;return}}(!y||v!==void 0)&&(a.selectedIndex=-1)}function Xa(a){var v=new MutationObserver(()=>{ra(a,a.__value)});v.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ca(()=>{v.disconnect()})}function $a(a,v,y=v){var b=new WeakSet,p=!0;Xe(a,"change",r=>{var z=r?"[selected]":":checked",d;if(a.multiple)d=[].map.call(a.querySelectorAll(z),ne);else{var f=a.querySelector(z)??a.querySelector("option:not([disabled])");d=f&&ne(f)}y(d),O!==null&&b.add(O)}),Na(()=>{var r=v();if(a===document.activeElement){var z=$e??O;if(b.has(z))return}if(ra(a,r,p),p&&r===void 0){var d=a.querySelector(":checked");d!==null&&(r=ne(d),y(r))}a.__value=r,p=!1}),Xa(a)}function ne(a){return"__value"in a?a.__value:a.value}function je(a,v,y=v){var b=new WeakSet;Xe(a,"input",async p=>{var r=p?a.defaultValue:a.value;if(r=ze(a)?Se(r):r,y(r),O!==null&&b.add(O),await Ra(),r!==(r=v())){var z=a.selectionStart,d=a.selectionEnd,f=a.value.length;if(a.value=r??"",d!==null){var c=a.value.length;z===d&&d===f&&c>f?(a.selectionStart=c,a.selectionEnd=c):(a.selectionStart=z,a.selectionEnd=Math.min(d,c))}}}),(Ia&&a.defaultValue!==a.value||m(v)==null&&a.value)&&(y(ze(a)?Se(a.value):a.value),O!==null&&b.add(O)),Ma(()=>{var p=v();if(a===document.activeElement){var r=$e??O;if(b.has(r))return}ze(a)&&p===Se(a.value)||a.type==="date"&&!p&&!a.value||p!==a.value&&(a.value=p??"")})}function ze(a){var v=a.type;return v==="number"||v==="range"}function Se(a){return a===""?null:+a}var et=N('<span class="meta svelte-at7k0o"> </span>'),at=N('<span class="reason svelte-at7k0o"> </span>'),tt=N('<div><div class="main svelte-at7k0o"><div class="label svelte-at7k0o"><span> </span> <!> <!></div> <span class="points svelte-at7k0o"> </span></div> <div class="counter svelte-at7k0o"><button type="button" class="step svelte-at7k0o">-</button> <input type="number" min="0" inputmode="numeric" class="svelte-at7k0o"/> <button type="button" class="step svelte-at7k0o">+</button></div></div>'),st=N('<span class="reason svelte-at7k0o"> </span>'),rt=N('<label><input type="checkbox" class="svelte-at7k0o"/> <span class="label svelte-at7k0o"> <!></span> <span class="points svelte-at7k0o"> </span></label>'),nt=N('<section class="group svelte-at7k0o"><h2 class="svelte-at7k0o"> </h2> <div class="items svelte-at7k0o"></div></section>');function lt(a,v){ea(v,!0);let y=ja(v,"counts",19,()=>({}));function b(c){const l=typeof c=="number"?c:Number(c);return Number.isFinite(l)?Math.max(0,Math.floor(l)):0}function p(c,l){v.onCountChange(c,b(l))}var r=nt(),z=s(r),d=s(z,!0);t(z);var f=n(z,2);Te(f,21,()=>v.activities,c=>c.key,(c,l)=>{var C=La(),W=aa(C);{var P=L=>{var h=tt();let M;var x=s(h),w=s(x),F=s(w),Q=s(F,!0);t(F);var G=n(F,2);{var J=D=>{var A=et(),U=s(A);t(A),R(()=>_(U,`${e(l).durationMinutes??""}m`)),T(D,A)};V(G,D=>{e(l).durationMinutes&&D(J)})}var $=n(G,2);{var I=D=>{var A=at(),U=s(A);t(A),R(()=>_(U,`(${v.disabledReasonByKey[e(l).key]??""})`)),T(D,A)};V($,D=>{v.disabledReasonByKey?.[e(l).key]&&D(I)})}t(w);var B=n(w,2),ee=s(B);t(B),t(x);var ae=n(x,2),Y=s(ae);Y.__click=()=>p(e(l).key,(y()?.[e(l).key]??0)-1);var q=n(Y,2);Le(q),q.__input=D=>p(e(l).key,Number(D.currentTarget.value));var H=n(q,2);H.__click=()=>p(e(l).key,(y()?.[e(l).key]??0)+1),t(ae),t(h),R(()=>{M=Ze(h,1,"item repeatable svelte-at7k0o",null,M,{disabled:v.disabledKeys?.[e(l).key]??!1}),_(Q,e(l).label),_(ee,`${e(l).points??""}pt ea`),sa(ae,"aria-label",`Count for ${e(l).label}`),Y.disabled=v.disabledKeys?.[e(l).key]??!1,q.disabled=v.disabledKeys?.[e(l).key]??!1,Ua(q,y()?.[e(l).key]??0),H.disabled=v.disabledKeys?.[e(l).key]??!1}),T(L,h)},K=L=>{var h=rt();let M;var x=s(h);Le(x),x.__change=I=>v.onToggle(e(l).key,I.currentTarget.checked);var w=n(x,2),F=s(w),Q=n(F);{var G=I=>{var B=st(),ee=s(B);t(B),R(()=>_(ee,`(${v.disabledReasonByKey[e(l).key]??""})`)),T(I,B)};V(Q,I=>{v.disabledReasonByKey?.[e(l).key]&&I(G)})}t(w);var J=n(w,2),$=s(J);t(J),t(h),R(()=>{M=Ze(h,1,"item svelte-at7k0o",null,M,{disabled:v.disabledKeys?.[e(l).key]??!1}),x.disabled=v.disabledKeys?.[e(l).key]??!1,Va(x,v.completed[e(l).key]??!1),_(F,`${e(l).label??""} `),_($,`${e(l).points??""}pt`)}),T(L,h)};V(W,L=>{e(l).repeatable??!1?L(P):L(K,!1)})}T(c,C)}),t(f),t(r),R(()=>_(d,v.group)),T(a,r),ta()}Wa(["click","input","change"]);var it=N("<option> </option>"),vt=N("<p>Loading...</p>"),ot=N('<p class="error svelte-b2zgdd"> </p>'),dt=N('<p class="muted svelte-b2zgdd"> </p>'),ut=N('<div class="grid svelte-b2zgdd"><div class="left svelte-b2zgdd"></div> <aside class="right svelte-b2zgdd"><section class="card svelte-b2zgdd"><h2 class="svelte-b2zgdd">Summary</h2> <div class="kv svelte-b2zgdd"><span>Mobility</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Conditioning</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Strength</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Nutrition</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Miscellaneous</span><span> </span></div> <hr class="svelte-b2zgdd"/> <div class="kv svelte-b2zgdd"><span>Training (capped)</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Lifestyle (capped)</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Total</span><span> </span></div> <hr class="svelte-b2zgdd"/> <div class="kv svelte-b2zgdd"><span>MED met</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Daily win</span><span> </span></div> <div class="kv svelte-b2zgdd"><span>Training rating</span> <span> </span></div> <div class="kv svelte-b2zgdd"><span>Lifestyle rating</span> <span> </span></div></section> <section class="card svelte-b2zgdd"><h2 class="svelte-b2zgdd">Notes</h2> <textarea class="svelte-b2zgdd"></textarea></section> <button class="save svelte-b2zgdd"> </button> <!> <!></aside></div>'),ct=N('<h1>Daily Log</h1> <div class="controls svelte-b2zgdd"><div class="dateControl svelte-b2zgdd"><label class="svelte-b2zgdd"><span class="svelte-b2zgdd">Date</span> <input type="date" class="svelte-b2zgdd"/></label> <div class="dateNav svelte-b2zgdd" aria-label="Day navigation"><button type="button" class="ghost svelte-b2zgdd">Prev</button> <button type="button" class="ghost svelte-b2zgdd">Next</button></div></div> <label class="svelte-b2zgdd"><span class="svelte-b2zgdd">Readiness</span> <select class="svelte-b2zgdd"></select></label></div> <!>',1);function Tt(a,v){ea(v,!1);const y=()=>Ya(Za,"$page",b),[b,p]=Qa(),r=E(),z=["fatigued","normal","good"];let d=E(Ve(new Date)),f=E("normal"),c=E({}),l=E({}),C=E(""),W=E(!1),P=E(!1),K=E(null),L=E(null),h=null,M=!1,x="",w=!1;const F=Array.from(new Set(We.map(o=>o.group)));function Q(){return JSON.stringify({date:e(d),readiness:e(f),completed:e(c),counts:e(l),notes:e(C)})}async function G(o){u(W,!0);try{const i=await Ga(o);w=!0,i?(u(f,i.readiness),u(c,i.completed??{}),u(l,i.counts??{}),u(C,i.notes??""),u(K,i.updatedAt),x=JSON.stringify({date:i.date,readiness:i.readiness,completed:i.completed,counts:i.counts,notes:i.notes})):(u(f,"normal"),u(c,{}),u(l,{}),u(C,""),u(K,null),x=JSON.stringify({date:o,readiness:"normal",completed:{},counts:{},notes:""})),u(L,null)}finally{u(W,!1)}}async function J(o){if(e(P)){M=M||o==="autosave";return}u(L,null),u(P,!0);try{const i=await Ja({date:e(d),readiness:e(f),completed:e(c),counts:e(l),notes:e(C)});u(K,i.updatedAt),x=Q()}catch(i){u(L,i instanceof Error?i.message:"Failed to save.")}finally{u(P,!1),M&&(M=!1,B())}}function $(o,i){u(c,{...e(c),[o]:i})}function I(o,i){const g=Number.isFinite(i)?Math.max(0,Math.floor(i)):0;u(l,{...e(l),[o]:g})}function B(){if(e(W))return;if(w){w=!1;return}Q()!==x&&(h&&clearTimeout(h),h=setTimeout(()=>{h=null,J("autosave")},650))}function ee(){J("manual")}function ae(o){return We.filter(i=>i.group===o)}function Y(o,i){const g=new Date(`${o}T12:00:00.000Z`);return Number.isFinite(g.getTime())?(g.setUTCDate(g.getUTCDate()+i),Ve(g)):o}function q(o){const i=new URL(y().url);i.searchParams.set("date",o),Ha(i.pathname+i.search,{replaceState:!1,keepFocus:!0,noScroll:!0})}Ba(()=>{G(e(d))});let H=E(null);ie(()=>y(),()=>{const o=y().url.searchParams.get("date");o&&u(d,o)}),ie(()=>(e(d),e(f),e(c),e(l),e(C)),()=>{u(r,Pa({date:e(d),readiness:e(f),completed:e(c),counts:e(l),notes:e(C)}))}),ie(()=>{},()=>{B()}),ie(()=>(e(H),e(d)),()=>{e(H)!==e(d)&&typeof window<"u"&&(u(H,e(d)),G(e(d)))}),Ka(),Da();var D=ct(),A=n(aa(D),2),U=s(A),ve=s(U),De=n(s(ve),2);Le(De),t(ve);var Ne=n(ve,2),Ce=s(Ne),na=n(Ce,2);t(Ne),t(U);var we=n(U,2),oe=n(s(we),2);R(()=>{e(f),Fa(()=>{})}),Te(oe,5,()=>z,o=>o,(o,i)=>{var g=it(),le=s(g,!0);t(g);var Z={};R(te=>{_(le,te),Z!==(Z=e(i))&&(g.value=(g.__value=e(i))??"")},[()=>(j(X),j(Qe),e(i),m(()=>X(Qe[e(i)])))]),T(o,g)}),t(oe),t(we),t(A);var la=n(A,2);{var ia=o=>{var i=vt();T(o,i)},va=o=>{var i=ut(),g=s(i);Te(g,5,()=>F,k=>k,(k,S)=>{{let re=qa(()=>(e(S),m(()=>ae(e(S)))));lt(k,{get group(){return e(S)},get activities(){return e(re)},get completed(){return e(c)},get counts(){return e(l)},onToggle:$,onCountChange:I})}}),t(g);var le=n(g,2),Z=s(le),te=n(s(Z),2),Ae=n(s(te)),oa=s(Ae,!0);t(Ae),t(te);var de=n(te,2),Ee=n(s(de)),da=s(Ee,!0);t(Ee),t(de);var ue=n(de,2),Re=n(s(ue)),ua=s(Re,!0);t(Re),t(ue);var ce=n(ue,2),Me=n(s(ce)),ca=s(Me,!0);t(Me),t(ce);var _e=n(ce,2),Ie=n(s(_e)),_a=s(Ie,!0);t(Ie),t(_e);var pe=n(_e,4),Be=n(s(pe)),pa=s(Be,!0);t(Be),t(pe);var fe=n(pe,2),Ke=n(s(fe)),fa=s(Ke,!0);t(Ke),t(fe);var be=n(fe,2),Fe=n(s(be)),ba=s(Fe,!0);t(Fe),t(be);var ge=n(be,4),qe=n(s(ge)),ga=s(qe,!0);t(qe),t(ge);var me=n(ge,2),Oe=n(s(me)),ma=s(Oe,!0);t(Oe),t(me);var ye=n(me,2),Pe=n(s(ye),2),ya=s(Pe,!0);t(Pe),t(ye);var Ge=n(ye,2),Je=n(s(Ge),2),ka=s(Je,!0);t(Je),t(Ge),t(Z);var ke=n(Z,2),he=n(s(ke),2);Oa(he),sa(he,"rows",6),t(ke);var se=n(ke,2),ha=s(se,!0);t(se);var Ue=n(se,2);{var xa=k=>{var S=ot(),re=s(S,!0);t(S),R(()=>_(re,e(L))),T(k,S)};V(Ue,k=>{e(L)&&k(xa)})}var za=n(Ue,2);{var Sa=k=>{var S=dt(),re=s(S);t(S),R(Ta=>_(re,`Saved ${Ta??""}`),[()=>(e(K),m(()=>new Date(e(K)).toLocaleString()))]),T(k,S)};V(za,k=>{e(K)&&k(Sa)})}t(le),t(i),R((k,S)=>{_(oa,(e(r),m(()=>e(r).rawByCategory.mobility))),_(da,(e(r),m(()=>e(r).rawByCategory.conditioning))),_(ua,(e(r),m(()=>e(r).rawByCategory.strength))),_(ca,(e(r),m(()=>e(r).rawByCategory.nutrition))),_(_a,(e(r),m(()=>e(r).rawByCategory.miscellaneous))),_(pa,(e(r),m(()=>e(r).cappedTrainingPoints))),_(fa,(e(r),m(()=>e(r).cappedLifestylePoints))),_(ba,(e(r),m(()=>e(r).totalPoints))),_(ga,(e(r),m(()=>e(r).medMet?"yes":"no"))),_(ma,(e(r),m(()=>e(r).dailyWin?"yes":"no"))),_(ya,k),_(ka,S),se.disabled=e(P),_(ha,e(P)?"Saving...":"Save")},[()=>(j(X),j(Ye),e(r),m(()=>X(Ye[e(r).trainingRating]))),()=>(j(X),j(He),e(r),m(()=>X(He[e(r).lifestyleRating])))]),je(he,()=>e(C),k=>u(C,k)),xe("click",se,ee),T(o,i)};V(la,o=>{e(W)?o(ia):o(va,!1)})}je(De,()=>e(d),o=>u(d,o)),xe("click",Ce,()=>q(Y(e(d),-1))),xe("click",na,()=>q(Y(e(d),1))),$a(oe,()=>e(f),o=>u(f,o)),T(a,D),ta(),p()}export{Tt as component};
